# MULTI VPN бот для Telegram
## **Инструкция по установке и настройке** ##

## Арендуйте сервера

Если вы хотите установить на сервер не только бота, а еще VLESS VPN или Outline, 
то тогда вам понадобится VDS сервер с минимальным объемом HDD 7ГБ.
Если вы планируете что на сервере будет только бот тогда нужно мнинимум 5ГБ HDD.
Процессор и объем оперативной памяти нам не важны выбирайте дешовые варианты.
Операционную систему ставьте Ubuntu 22.

**Могу предложить вот таки варианты:**

https://ps.profitserver.pro/ - 330р

https://justhost.ru/ - 300р - отличная скорость

После аренды вам дадут IP сервера и пароль от него


## Подключение к серверу


Используйте любую программу для подключения через ssh, 
рекомендую MobaXterm (https://mobaxterm.mobatek.net/download.html)

**После установки:**

  1. Нажмите Session
  2. Выберете SSH
  3. В графе Remote host введите ip адрес 
  4. Нажимайте ОК 
  5. В главном меню выбирайте ваш сервер и начнется подключение
  6. Вас попросят ввести logi, вводите root  
  7. Введите пароль(обычно приходит в письме вместе с ip адресом). 
     Не пугайтесь если не будите видеть что вводите, на самом деле все вводится 
     просто скрыто, такая система защиты от любопытных глаз.


## Установка бота на сервере

Копируйте и вставляйте в командную строку команды:

1. Обновляем все стандартные пакеты

        sudo apt update && sudo apt upgrade -y

2. Устанавливаем python3

        sudo apt --reinstall install python3

3. Устанавливаем pip

       sudo apt --reinstall install python3-pip 

4. Устанавливаем Nodejs

       sudo apt install nodejs

5. Устанавливаем npm

       sudo apt install npm

6. Устанавливаем пакетный менеджер

       npm install pm2 -g
7. Устанавливаем библиотеку локализации

       apt-get install gettext

8. переносим на сервер папку VPNHubBot из архива
9. Переходим в папку

       cd VPNHubBot 

10. Устанавливаем все библиотеки бота 
      
        pip3 install -r requirements.txt
   
   Если у вас Ubuntu 23 то используйте эту команду

       pip3 install -r requirements.txt --break-system-packages

11. Откройте файл config.json и заполните все поля, там где стоит "" нужно 
вставить текст между скобок, что бы получилось вот так - "token" 
    ````
    "name": "Protecto VPN", - Название вашего бота
    "languages": "ru", - Язык бота который будет установлен по умолчанию
    "admin_tg_id": 111111111, - ваш ID в телеграме получить нужно здесь -> https://t.me/userinfobot
    "month_cost": [150,390,800], - цена в рублях за 1,3,6 месяцев подписки
    "deposit": [150,390,800], - суммы на которые пользователи могут пополнить баланс
    "trial_period": 27000, - бесплатный пробный период, указывается в секундах
    "trial_price": 100, - цена платного пробного периода 
    "trial_duration_days": 1, - платный пробный период, указывается в сутках
    "trial_duration": 1, - продолжительность платного пробного периода 
    "UTC_time": 3, - временной пояс, по умолчанию стоит московское время
    "max_people_server": 20, - максимальное количество человек на сервере
    "limit_ip": 0, - максимальное количество устройств на котором пользователь сможет импользовать ключ(0 - без лимита)
    "limit_GB": 0, - максимальное количество ГБ для пользователя(0 - без лимита)
    "tg_token": "", - Токен бота нужно получить у BotFather https://t.me/BotFather
    "yoomoney_token": "Токен Юмани что бы его получить нужно 
                           1) зарегистрировать https://yoomoney.ru/myservices/new приложение",
                              в ссылках указывайте бота, галочку внизу НЕ СТАВИТЬ!
                           2) получить токен выполнив скрипт на этой странице
                              https://colab.research.google.com/drive/1QtFtyttF_kq67DUxLjhstE08CaUWQ_RG?usp=sharing
    "yoomoney_wallet_token": "Номер кошелька Юмани", 
    "tg_wallet_token": "", - Токен WalletPay получить здесь https://pay.wallet.tg/
    "lava_token_secret": "Получить секретный токен вы можете здесь https://business.lava.ru/ зарегестрируйте проект",
    "lava_id_project": "В ссылках указывайте адрес бота, когда проект создан напишите в этот бот с
                        с просьбой отправить бота на модерацию https://t.me/lava_support_bot",
    "yookassa_shop_id": "Зарегестрируйте в ЮКассе и создайте там приложение",
    "yookassa_secret_key": "Берется там же где и shop id",
    "recurring_payment_amount": 50, - Сумма рекуррентных платежей, в рублях
    "referral_day": 3, - Количество дней которое дается пользователю за человека который перешёл по реф. ссылке
    "referral_percent": 30, - Процент от суммы который получает пользователь если его реферал пополняет баланс 
    "minimum_withdrawal_amount": 500 - Минимальная сумма вывода

12. Перейдите в BotFather и выберите /mybots, вашего бота. 
13. Перейдите в Edit Bot - здесь вы можете задать картинки и описания для бота
14. Запускаем бота

        pm2 start run.py --interpreter=python3

После запуска, проверьте что все запустилось в Telegram
Спомощью admin панели добавьте себе любое количество дней


## Редактирование текста

1. Остановить бота

       pm2 stop run

2. Перейти в папку locale, в этой папке есть ru en и подобные, в этих папках 
лежат файлы перевода под названием bot.po в них вы и должны изменять текст

3. После внесения изменений в файлы вы должны 

    Перейти в папку с ботом

       cd VPNHubBot

   Выполнить команду 

       sh compile_translations.sh

4. Запускаем бота

       pm2 start run.py --interpreter=python3

Для любого изменения в файлах необходимо повторять этот алгоритм!


## Установка VPN VLESS на сервер

**Внимание!** 

**У VLESS VPN есть широкий спектр настроек,**
**бот настроен на работу VLess + Reality**
Инструкция по установке Vless + Reality
Если вам нужны картинки можете воспользоваться этой статьёй https://clck.ru/36gPZJ
1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка панели XU-I

       bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)

3. Отвечаем на вопросы, которые спрашивает нас скрипт
    ````
   Do you want to continue with the modification [y/n]? :y - впишите y
    Please set up your username:admin1 - впишите логин для администратора
    Your username will be:admin1 
    Please set up your password:admin1234 - впишите пароль для администратора
    Your password will be:admin1234 
    Please set up the panel port:5555 - впишите порт, это могут быть любые 4 числа
    Your panel port is:555
4. Заходим в наш веб интерфейс. в строке браузера пишем:

       http://vps_ip:5555/

    *5555 это порт который мы писали при установке.
5. Заходите в **Подключения**
6. Нажимайте **Добавить подключение**
    ````
    Отметить протокол Reality - поставить галку
    Нажать GET NEW KEY - внизу слева
    Нажать Создать

В результате будет создано подключение с одним обязательным пользователем,
вы можете изменить его имя на admin

## Установка ShadowSocks на сервер
Если вы до этого устанавливали Vless переходите к шагу №6

1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка панели XU-I

       bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)

3. Отвечаем на вопросы, которые спрашивает нас скрипт
    ````
   Do you want to continue with the modification [y/n]? :y - впишите y
    Please set up your username:admin1 - впишите логин для администратора
    Your username will be:admin1 
    Please set up your password:admin1234 - впишите пароль для администратора
    Your password will be:admin1234 
    Please set up the panel port:5555 - впишите порт, это могут быть любые 4 числа
    Your panel port is:555
4. Заходим в наш веб интерфейс. в строке браузера пишем:

       http://vps_ip:5555/

    *5555 это порт который мы писали при установке.
5. Заходите в **Подключения**
6. Нажимайте **Добавить подключение**
    ````
    Протокол выбираейте shadowsocks
    Создать
   
В результате будет создано подключение с одним обязательным пользователем,
вы можете изменить его имя на admin


## Установка Outline на сервер

1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка outline

       sudo wget -qO- https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh | bash

При необходимости можно установить Docker отдельно до ввода 2 команды

        sudo curl https://get.docker.com | sh

Когда скрипт закончит работу выведет вот такой текст:
```
{ 
  "apiUrl": "https://0.0.0.0:0000/XXXXXXXXXXXX", 
  "certSha256": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" 
}
```
Обязательно сохраните его к себе на компьютер, 
эти данные понадобятся боту в пункте 6.

## Добавление сервера в бот

1. Переходите в `Сервера` --> `Добавить сервер`
2. Введите любое имя, главное, что бы оно было уникальным(используйте смайлы) 
3. Введите адрес вашего сервера **БЕЗ HTTP://** только ip адрес и порт как в примере у бота
4. Введите пароль от VDS можете ввсети любое занчение бот никак не использует этот пароль
5. Выберете тип VPN
6. Если вы выбрали Otline введите данные которые сохраняли при установке Outline
7. Если выбрали Vless или ShadowSoks следуйте инструкции дальше
8. Тип подключения выбирайте HTTP
9. Панель управления выбирайте Sanae
10. ID подключения можно посмотреть в панели управления,
перейдите в `Подключения` справа от кнопки с + будет номер, это и есть ID подключения
11. Введите логин который вы использовали для входа в панель управления
12. Введите пароль который вы использовали для входа в панель управления
Если вы подключаете сервер на котором раньше были клиенты, то нужно удалить старые подключения клиентов 

# Все! Бот установлен, VPN добавлен, теперь вы можете пользоваться ботом